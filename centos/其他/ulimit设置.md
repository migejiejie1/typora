# **更改Linux打开的最大文件数为65535**

linux系统对文件打开的数量有最大的限制，它通常设置为1024，这个数值很容易会达到，从而造成系统程序或者系统的瓶颈。因此，本文从进程本身和系统上说明如何更改linux最大文件数的限制！

 

首先通过命令ulimit -a查看当前进程可以打开的最大文件数，如下图所示，显示是1024

![img](../Image/wps1-16653720767441.jpg) 

另外还可以通过命令ulimit -n 直接查看当前进程可以打开文件的最大数量

![img](../Image/wps2-16653720767467.jpg) 

上面两个命令是查看当前进程最大文件数，而系统也有最大文件数，它指的是所有进程可以打开的文件数量，如下图所示的命令可以查看当前系统的最大文件数

![img](../Image/wps3-16653720767454.jpg) 

说明如何查看文件数量限制之后，接下来就说明如何更改最大文件数，通过命令ulimit -n 65535可以进行更改

![img](../Image/wps4-16653720767452.jpg) 

通过命令ulimit -n 65535只对当前进程生效，如下图所示，退出shell进程，再进入查看最大文件数变成原来的值1024

![img](../Image/wps5-16653720767453.jpg) 

如果想要永久生效，可以通过输入下图所示的两条命令来达到更改最大文件数永久生效的目的

 

![img](../Image/wps6-16653720767455.jpg) 

通过下图看，退出shell进程，重新查看最大文件数，已经是更改的值65535，说明永久生效的命令是正确的！

![img](../Image/wps7-16653720767466.jpg) 

上面更改最大文件数的命令只针对进程而言，如果想要更改整个系统的最大文件数，那么通过下图红色方框的命令可以进行更改

![img](../Image/wps8-16653720767468.jpg)同样上面更改系统最大文件数的命令只是临时生效，当退出进程就会失效，因此，如果想要永久生效，通过在文件/etc/sysctl.conf添加下图红色方框标示的命令就可以永久生效！

![img](../Image/wps9-16653720767469.jpg) 

 

```shell
正确设置Linux的ulimit值的方法

max_conn

描述：服务器允许维持的最大TCP连接数
说明：设置此参数后，当服务器已有的连接数达到该值时，新的连接会被拒绝。另外，该参数的值不能超过操作系统ulimit -n的值，同时此值也不宜设置过大，因为swoole_server会一次性申请一大块内存用于存放每一个connection的信息。这个值也会影响服务器的最大并发数，其实Linux是有文件句柄限制的，而且Linux默认不是很高，一般都是1024，生产服务器很容易就达到这个数量。

　　正确设置Linux的ulimit -n的值的步骤如下：

　　1.先用命令ulimit -n 查看目前的值

　　2. vim /etc/security/limits.conf

　　　　建议把下面两项都设置为65535

　　　　* soft nofile 65535 

　　　　* hard nofile 65535

　　　　（前面的*星号代表全局，针对所有的用户；nofile代表文件句柄数量；soft nofile的值不能超过hard nofile的值）

　　3.重启Linux系统

　　　　命令：shutdown -r now 表示立即重启

临时设置 ulimit 值

ulimit -n 65535

```

